# ---------------------------------------------------------------------------- #
#                                   Fragments                                  #
# ---------------------------------------------------------------------------- #

fragment orderMinimal on Order {
  id
  status
  tx

  events {
    timestamp
  }

  client {
    id
  }

  seller {
    id
  }

  listing {
    id
    title
    price
    bondFee
    deliveryDays
    revisions
  }
}

fragment orderFull on Order {
  id
  tx
  status
  revisionsLeft
  underRevision
  bondFeeWithdrawn

  events {
    type
    timestamp
    from {
      id
    }
  }

  listing {
    id
    title
    price
    bondFee
    deliveryDays
    revisions
  }

  tips {
    amount
    timestamp
  }

  client {
    id
  }

  seller {
    id
  }
}

# ---------------------------------------------------------------------------- #
#                                    Queries                                   #
# ---------------------------------------------------------------------------- #

#
# Get all orders from a client on a listing
#

query getMinimalOrdersByTx(
  $listingId: String!
  $clientId: String!
  $txHash: String!
) {
  orders(where: { listing: $listingId, client: $clientId, tx: $txHash }) {
    ...orderMinimal
  }
}

#
# Get a all orders received by a seller
#

query getSellerOrders($sellerId: String!, $cursor: String = "", $limit: Int) {
  orders(
    where: { seller: $sellerId, id_gt: $cursor }
    first: $limit
    orderBy: id
    orderDirection: desc
  ) {
    ...orderMinimal
  }
}

#
# Get a all orders placed by a client
#

query getClientOrders($clientId: String!, $cursor: String = "", $limit: Int) {
  orders(
    where: { client: $clientId, id_gt: $cursor }
    first: $limit
    orderBy: id
    orderDirection: desc
  ) {
    ...orderMinimal
  }
}

#
# Get an order by ud
#

query getOrderById($composedOrderId: ID!) {
  order(id: $composedOrderId) {
    ...orderFull
  }
}
